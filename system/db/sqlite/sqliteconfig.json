{
  "tables": [
    {
      "name": "Users",
      "columns": [
        { "name": "ID", "type": "TEXT", "constraint": "PRIMARY KEY" },
        { "name": "UserID", "type": "TEXT", "constraint": "UNIQUE NOT NULL" },
        { "name": "Email", "type": "TEXT", "constraint": "UNIQUE NOT NULL" },
        { "name": "PasswordHash", "type": "TEXT", "constraint": "NOT NULL" }
      ]
    },
    {
      "name": "User_Data",
      "columns": [
        { "name": "ID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Name", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Data", "type": "BLOB", "constraint": "" }
      ],
      "primary_key": ["ID", "Name"]
    },
    {
      "name": "LoginSessions",
      "columns": [
        { "name": "SessionID", "type": "TEXT", "constraint": "PRIMARY KEY" },
        { "name": "UserID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Provider", "type": "TEXT", "constraint": "" },
        { "name": "AuthenticationTime", "type": "INTEGER", "constraint": "NOT NULL" },
        { "name": "LogonExpires", "type": "INTEGER", "constraint": "NOT NULL" },
        { "name": "AuthenticationState", "type": "TEXT", "constraint": "" },
        { "name": "UserAgent", "type": "TEXT", "constraint": "" }
      ],
      "foreign_keys": [
        {
          "column": "UserID",
          "references": "Users(UserID)",
          "on_delete": "CASCADE"
        }
      ]
    },
    {
      "name": "User_Groups",
      "columns": [
        { "name": "GroupID", "type": "TEXT", "constraint": "PRIMARY KEY" },
        { "name": "Name", "type": "TEXT", "constraint": "UNIQUE NOT NULL" },
        { "name": "Updated", "type": "TEXT", "constraint": "" },
        { "name": "Created", "type": "TEXT", "constraint": "" }
      ]
    },
    {
      "name": "User_Groups_Map",
      "columns": [
        { "name": "UserID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "GroupID", "type": "TEXT", "constraint": "NOT NULL" }
      ],
      "primary_key": ["UserID", "GroupID"],
      "foreign_keys": [
        {
          "column": "UserID",
          "references": "Users(UserID)",
          "on_delete": "CASCADE"
        },
        {
          "column": "GroupID",
          "references": "User_Groups(GroupID)",
          "on_delete": "CASCADE"
        }
      ]
    },
    {
      "name": "PSWeb_Roles",
      "columns": [
        { "name": "PrincipalID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "PrincipalType", "type": "TEXT", "constraint": "NOT NULL CHECK(PrincipalType IN ('User', 'Group'))" },
        { "name": "RoleName", "type": "TEXT", "constraint": "NOT NULL" }
      ],
      "primary_key": ["PrincipalID", "RoleName"]
    },
    {
      "name": "AuthenticationMethods",
      "columns": [
        { "name": "ID", "type": "INTEGER", "constraint": "PRIMARY KEY AUTOINCREMENT" },
        { "name": "UserID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Authentication_Method", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Data", "type": "TEXT", "constraint": "" }
      ],
      "foreign_keys": [
        {
          "column": "UserID",
          "references": "Users(UserID)",
          "on_delete": "CASCADE"
        }
      ]
    },
    {
      "name": "CardSessions",
      "columns": [
        { "name": "CardGUID", "type": "TEXT", "constraint": "PRIMARY KEY" },
        { "name": "SessionID", "type": "TEXT", "constraint": "" },
        { "name": "UserID", "type": "TEXT", "constraint": "" },
        { "name": "DataBackend", "type": "TEXT", "constraint": "" },
        { "name": "CardDefinition", "type": "TEXT", "constraint": "" }
      ],
      "foreign_keys": [
        {
          "column": "SessionID",
          "references": "LoginSessions(SessionID)",
          "on_delete": "SET NULL"
        },
        {
          "column": "UserID",
          "references": "Users(UserID)",
          "on_delete": "SET NULL"
        }
      ]
    },
    {
      "name": "auth_user_provider",
      "columns": [
        { "name": "UserID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "UserName", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "provider", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "created", "type": "TEXT", "constraint": "" },
        { "name": "locked_out", "type": "INTEGER", "constraint": "DEFAULT 0" },
        { "name": "expires", "type": "TEXT", "constraint": "" },
        { "name": "enabled", "type": "INTEGER", "constraint": "DEFAULT 1" },
        { "name": "data", "type": "TEXT", "constraint": "" }
      ],
      "primary_key": ["UserID", "provider"],
      "foreign_keys": [
        {
          "column": "UserID",
          "references": "Users(UserID)",
          "on_delete": "CASCADE"
        }
      ]
    },
    {
      "name": "LastLoginAttempt",
      "columns": [
        { "name": "IPAddress", "type": "TEXT", "constraint": "PRIMARY KEY" },
        { "name": "Username", "type": "TEXT", "constraint": "" },
        { "name": "Time", "type": "TEXT", "constraint": "" },
        { "name": "UserNameLockedUntil", "type": "TEXT", "constraint": "" },
        { "name": "IPAddressLockedUntil", "type": "TEXT", "constraint": "" },
        { "name": "UserViolationsCount", "type": "INTEGER", "constraint": "DEFAULT 0" },
        { "name": "IPViolationCount", "type": "INTEGER", "constraint": "DEFAULT 0" }
      ]
    },
    {
      "name": "account_email_confirmation",
      "columns": [
        { "name": "email_request_guid", "type": "TEXT", "constraint": "PRIMARY KEY" },
        { "name": "email", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "request_date", "type": "TEXT", "constraint": "" },
        { "name": "response_date", "type": "TEXT", "constraint": "" },
        { "name": "request_ip", "type": "TEXT", "constraint": "" },
        { "name": "response_ip", "type": "TEXT", "constraint": "" },
        { "name": "request_session_id", "type": "TEXT", "constraint": "" },
        { "name": "response_session_id", "type": "TEXT", "constraint": "" }
      ]
    },
    {
      "name": "card_settings",
      "columns": [
        { "name": "endpoint_guid", "type": "TEXT", "constraint": "" },
        { "name": "user_id", "type": "TEXT", "constraint": "" },
        { "name": "created_date", "type": "TEXT", "constraint": "" },
        { "name": "last_updated", "type": "TEXT", "constraint": "" },
        { "name": "data", "type": "TEXT", "constraint": "" }
      ],
      "primary_key": ["endpoint_guid", "user_id"],
      "foreign_keys": [
        {
          "column": "user_id",
          "references": "Users(UserID)",
          "on_delete": "CASCADE"
        }
      ]
    },
    {
      "name": "API_Keys",
      "columns": [
        { "name": "KeyID", "type": "TEXT", "constraint": "PRIMARY KEY" },
        { "name": "Name", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "KeyHash", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "UserID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "AllowedIPs", "type": "TEXT", "constraint": "" },
        { "name": "CreatedBy", "type": "TEXT", "constraint": "" },
        { "name": "CreatedAt", "type": "TEXT", "constraint": "" },
        { "name": "ExpiresAt", "type": "TEXT", "constraint": "" },
        { "name": "LastUsed", "type": "TEXT", "constraint": "" },
        { "name": "Enabled", "type": "INTEGER", "constraint": "DEFAULT 1" },
        { "name": "Description", "type": "TEXT", "constraint": "" }
      ],
      "foreign_keys": [
        {
          "column": "UserID",
          "references": "Users(UserID)",
          "on_delete": "CASCADE"
        }
      ]
    },
    {
      "name": "Shared_Buckets",
      "columns": [
        { "name": "BucketID", "type": "TEXT", "constraint": "PRIMARY KEY" },
        { "name": "Name", "type": "TEXT", "constraint": "UNIQUE NOT NULL" },
        { "name": "Description", "type": "TEXT", "constraint": "" },
        { "name": "OwnerUserID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "OwnerGroupID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "ReadGroupID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "WriteGroupID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Created", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Updated", "type": "TEXT", "constraint": "NOT NULL" }
      ],
      "foreign_keys": [
        {
          "column": "OwnerUserID",
          "references": "Users(UserID)",
          "on_delete": "CASCADE"
        },
        {
          "column": "OwnerGroupID",
          "references": "User_Groups(GroupID)",
          "on_delete": "RESTRICT"
        },
        {
          "column": "ReadGroupID",
          "references": "User_Groups(GroupID)",
          "on_delete": "RESTRICT"
        },
        {
          "column": "WriteGroupID",
          "references": "User_Groups(GroupID)",
          "on_delete": "RESTRICT"
        }
      ]
    },
    {
      "name": "Bucket_Access_Log",
      "columns": [
        { "name": "LogID", "type": "TEXT", "constraint": "PRIMARY KEY" },
        { "name": "BucketID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "UserID", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Action", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Path", "type": "TEXT", "constraint": "" },
        { "name": "Timestamp", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Success", "type": "INTEGER", "constraint": "DEFAULT 1" },
        { "name": "ErrorMessage", "type": "TEXT", "constraint": "" }
      ],
      "foreign_keys": [
        {
          "column": "BucketID",
          "references": "Shared_Buckets(BucketID)",
          "on_delete": "CASCADE"
        }
      ]
    }
  ]
}
