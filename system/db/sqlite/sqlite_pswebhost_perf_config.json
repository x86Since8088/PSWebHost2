{
  "tables": [
    {
      "name": "WebRequestPerformance",
      "columns": [
        { "name": "RequestID", "type": "TEXT", "constraint": "PRIMARY KEY" },
        { "name": "StartTime", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "EndTime", "type": "TEXT", "constraint": "" },
        { "name": "FilePath", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "HttpMethod", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "UserID", "type": "TEXT", "constraint": "" },
        { "name": "AuthenticationProvider", "type": "TEXT", "constraint": "" },
        { "name": "ExecutionTimeMicroseconds", "type": "INTEGER", "constraint": "" },
        { "name": "LogFileSizeBefore", "type": "INTEGER", "constraint": "" },
        { "name": "LogFileSizeAfter", "type": "INTEGER", "constraint": "" },
        { "name": "LogFileSizeDelta", "type": "INTEGER", "constraint": "" },
        { "name": "StatusCode", "type": "INTEGER", "constraint": "" },
        { "name": "StatusText", "type": "TEXT", "constraint": "" },
        { "name": "IPAddress", "type": "TEXT", "constraint": "" },
        { "name": "UserAgent", "type": "TEXT", "constraint": "" },
        { "name": "SessionID", "type": "TEXT", "constraint": "" },
        { "name": "Completed", "type": "INTEGER", "constraint": "DEFAULT 0" },
        { "name": "CreatedAt", "type": "TEXT", "constraint": "DEFAULT (datetime('now'))" }
      ],
      "indexes": [
        { "name": "idx_webrequest_starttime", "columns": ["StartTime"] },
        { "name": "idx_webrequest_filepath", "columns": ["FilePath"] },
        { "name": "idx_webrequest_userid", "columns": ["UserID"] },
        { "name": "idx_webrequest_completed", "columns": ["Completed"] },
        { "name": "idx_webrequest_exectime", "columns": ["ExecutionTimeMicroseconds"] }
      ]
    },
    {
      "name": "SystemPerformance",
      "columns": [
        { "name": "MetricID", "type": "INTEGER", "constraint": "PRIMARY KEY AUTOINCREMENT" },
        { "name": "Timestamp", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "CPUPercent", "type": "REAL", "constraint": "" },
        { "name": "MemoryUsedGB", "type": "REAL", "constraint": "" },
        { "name": "MemoryPercentUsed", "type": "REAL", "constraint": "" },
        { "name": "ProcessCount", "type": "INTEGER", "constraint": "" },
        { "name": "ThreadCount", "type": "INTEGER", "constraint": "" },
        { "name": "HandleCount", "type": "INTEGER", "constraint": "" },
        { "name": "CreatedAt", "type": "TEXT", "constraint": "DEFAULT (datetime('now'))" }
      ],
      "indexes": [
        { "name": "idx_sysperf_timestamp", "columns": ["Timestamp"] }
      ]
    },
    {
      "name": "Perf_MemoryUsage",
      "columns": [
        { "name": "ID", "type": "INTEGER", "constraint": "PRIMARY KEY AUTOINCREMENT" },
        { "name": "Timestamp", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Host", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "MB_Min", "type": "REAL", "constraint": "" },
        { "name": "MB_Max", "type": "REAL", "constraint": "" },
        { "name": "MB_Avg", "type": "REAL", "constraint": "" },
        { "name": "Seconds", "type": "INTEGER", "constraint": "NOT NULL" },
        { "name": "CreatedAt", "type": "TEXT", "constraint": "DEFAULT (datetime('now'))" }
      ],
      "indexes": [
        { "name": "idx_memory_timestamp", "columns": ["Timestamp"] },
        { "name": "idx_memory_host", "columns": ["Host"] },
        { "name": "idx_memory_seconds", "columns": ["Seconds"] }
      ]
    },
    {
      "name": "Perf_DiskIO",
      "columns": [
        { "name": "ID", "type": "INTEGER", "constraint": "PRIMARY KEY AUTOINCREMENT" },
        { "name": "Timestamp", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Host", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Drive", "type": "TEXT", "constraint": "" },
        { "name": "KBPerSec_Min", "type": "REAL", "constraint": "" },
        { "name": "KBPerSec_Max", "type": "REAL", "constraint": "" },
        { "name": "KBPerSec_Avg", "type": "REAL", "constraint": "" },
        { "name": "KBPerSec_Total", "type": "REAL", "constraint": "" },
        { "name": "IOPerSec_Min", "type": "REAL", "constraint": "" },
        { "name": "IOPerSec_Max", "type": "REAL", "constraint": "" },
        { "name": "IOPerSec_Avg", "type": "REAL", "constraint": "" },
        { "name": "IO_Total", "type": "INTEGER", "constraint": "" },
        { "name": "Seconds", "type": "INTEGER", "constraint": "NOT NULL" },
        { "name": "CreatedAt", "type": "TEXT", "constraint": "DEFAULT (datetime('now'))" }
      ],
      "indexes": [
        { "name": "idx_diskio_timestamp", "columns": ["Timestamp"] },
        { "name": "idx_diskio_host", "columns": ["Host"] }
      ]
    },
    {
      "name": "Perf_CPUCore",
      "columns": [
        { "name": "ID", "type": "INTEGER", "constraint": "PRIMARY KEY AUTOINCREMENT" },
        { "name": "Timestamp", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Host", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "CoreNumber", "type": "INTEGER", "constraint": "" },
        { "name": "Percent_Min", "type": "REAL", "constraint": "" },
        { "name": "Percent_Max", "type": "REAL", "constraint": "" },
        { "name": "Percent_Avg", "type": "REAL", "constraint": "" },
        { "name": "Temp_Min", "type": "REAL", "constraint": "" },
        { "name": "Temp_Max", "type": "REAL", "constraint": "" },
        { "name": "Temp_Avg", "type": "REAL", "constraint": "" },
        { "name": "Seconds", "type": "INTEGER", "constraint": "NOT NULL" },
        { "name": "CreatedAt", "type": "TEXT", "constraint": "DEFAULT (datetime('now'))" }
      ],
      "indexes": [
        { "name": "idx_cpu_timestamp", "columns": ["Timestamp"] },
        { "name": "idx_cpu_host", "columns": ["Host"] },
        { "name": "idx_cpu_core", "columns": ["CoreNumber"] }
      ]
    },
    {
      "name": "Network",
      "columns": [
        { "name": "ID", "type": "INTEGER", "constraint": "PRIMARY KEY AUTOINCREMENT" },
        { "name": "Timestamp", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "Host", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "AdapterName", "type": "TEXT", "constraint": "NOT NULL" },
        { "name": "AdapterType", "type": "TEXT", "constraint": "" },
        { "name": "VendorName", "type": "TEXT", "constraint": "" },
        { "name": "MACAddress", "type": "TEXT", "constraint": "" },
        { "name": "IngressKB_Min", "type": "REAL", "constraint": "" },
        { "name": "IngressKB_Max", "type": "REAL", "constraint": "" },
        { "name": "IngressKB_Avg", "type": "REAL", "constraint": "" },
        { "name": "IngressKB_Total", "type": "REAL", "constraint": "" },
        { "name": "EgressKB_Min", "type": "REAL", "constraint": "" },
        { "name": "EgressKB_Max", "type": "REAL", "constraint": "" },
        { "name": "EgressKB_Avg", "type": "REAL", "constraint": "" },
        { "name": "EgressKB_Total", "type": "REAL", "constraint": "" },
        { "name": "Seconds", "type": "INTEGER", "constraint": "NOT NULL" },
        { "name": "CreatedAt", "type": "TEXT", "constraint": "DEFAULT (datetime('now'))" }
      ],
      "indexes": [
        { "name": "idx_network_timestamp", "columns": ["Timestamp"] },
        { "name": "idx_network_host", "columns": ["Host"] },
        { "name": "idx_network_adapter", "columns": ["AdapterName"] },
        { "name": "idx_network_type", "columns": ["AdapterType"] }
      ]
    }
  ],
  "views": [
    {
      "name": "vw_RequestPerformanceSummary",
      "definition": "SELECT FilePath, COUNT(*) as RequestCount, AVG(ExecutionTimeMicroseconds) as AvgExecutionMicroseconds, MIN(ExecutionTimeMicroseconds) as MinExecutionMicroseconds, MAX(ExecutionTimeMicroseconds) as MaxExecutionMicroseconds, SUM(LogFileSizeDelta) as TotalLogGrowth, COUNT(DISTINCT UserID) as UniqueUsers FROM WebRequestPerformance WHERE Completed = 1 GROUP BY FilePath"
    },
    {
      "name": "vw_UserPerformance",
      "definition": "SELECT UserID, COUNT(*) as RequestCount, AVG(ExecutionTimeMicroseconds) as AvgExecutionMicroseconds, SUM(LogFileSizeDelta) as TotalLogGrowth FROM WebRequestPerformance WHERE Completed = 1 AND UserID IS NOT NULL GROUP BY UserID"
    },
    {
      "name": "vw_SlowRequests",
      "definition": "SELECT RequestID, StartTime, FilePath, UserID, ExecutionTimeMicroseconds, ExecutionTimeMicroseconds / 1000000.0 as ExecutionTimeSeconds FROM WebRequestPerformance WHERE Completed = 1 AND ExecutionTimeMicroseconds > 1000000 ORDER BY ExecutionTimeMicroseconds DESC"
    }
  ]
}
