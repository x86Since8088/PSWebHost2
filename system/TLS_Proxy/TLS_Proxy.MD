# TLS Proxy - Enterprise Gateway

A production-grade TLS terminating proxy with service mesh capabilities, multi-protocol support, and enterprise features implemented in PowerShell.

## Table of Contents

- [Overview](#overview)
- [Architecture](#architecture)
- [Features](#features)
- [Installation](#installation)
- [Configuration](#configuration)
- [Components](#components)
- [Protocols](#protocols)
- [Service Mesh](#service-mesh)
- [Message Queue Integration](#message-queue-integration)
- [Operations](#operations)
- [Metrics & Monitoring](#metrics--monitoring)
- [Security](#security)
- [Performance Tuning](#performance-tuning)
- [Troubleshooting](#troubleshooting)
- [Future Enhancements](#future-enhancements)

---

## Overview

TLS Proxy is a Layer 4/7 proxy designed for enterprise environments requiring:

- **TLS Termination** with SNI-based routing and certificate management
- **Multi-Protocol Support** including HTTP/HTTPS, gRPC, Redis, MySQL, and generic TCP
- **Service Mesh Capabilities** with service discovery, traffic management, and resilience patterns
- **Enterprise Observability** through distributed tracing, structured logging, and Prometheus metrics
- **Event-Driven Architecture** via Kafka, RabbitMQ, and Redis Pub/Sub integration

### Key Differentiators

| Feature | Description |
|---------|-------------|
| **Pure PowerShell** | No external dependencies required for core functionality |
| **Multi-Protocol** | Single proxy handles HTTP, gRPC, Redis, MySQL, TCP |
| **Service Mesh Native** | Built-in Consul/etcd integration, not a sidecar |
| **Event Streaming** | Async message publishing with backpressure handling |
| **Hot Reload** | Configuration changes without restart |

---

## Architecture

### High-Level Architecture

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚                    TLS PROXY                            â”‚
                                    â”‚                                                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ Clients â”‚â”€â”€â”€â”€â”€HTTPS/gRPCâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              TLS Listener (:8443)               â”‚   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚         SNI-based Certificate Selection          â”‚   â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚                          â”‚                             â”‚
    â”‚  Redis  â”‚â”€â”€â”€â”€â”€â”€â”€â”€TCPâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Redis Listener (:6380)                         â”‚   â”‚
    â”‚ Clients â”‚                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚                          â”‚                             â”‚
                                    â”‚                          â–¼                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  MySQL  â”‚â”€â”€â”€â”€â”€â”€â”€â”€TCPâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   MySQL Listener (:3307)                        â”‚   â”‚
    â”‚ Clients â”‚                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚                          â”‚                             â”‚
                                    â”‚                          â–¼                             â”‚
                                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                    â”‚  â”‚              WORKER POOL (N Runspaces)           â”‚   â”‚
                                    â”‚  â”‚                                                   â”‚   â”‚
                                    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
                                    â”‚  â”‚  â”‚ Worker 1â”‚ â”‚ Worker 2â”‚ â”‚ Worker Nâ”‚            â”‚   â”‚
                                    â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚   â”‚
                                    â”‚  â”‚       â”‚           â”‚           â”‚                  â”‚   â”‚
                                    â”‚  â”‚       â–¼           â–¼           â–¼                  â”‚   â”‚
                                    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
                                    â”‚  â”‚  â”‚            Request Pipeline              â”‚    â”‚   â”‚
                                    â”‚  â”‚  â”‚                                          â”‚    â”‚   â”‚
                                    â”‚  â”‚  â”‚  Rate Limit â†’ Auth â†’ Circuit Breaker    â”‚    â”‚   â”‚
                                    â”‚  â”‚  â”‚       â†“                                  â”‚    â”‚   â”‚
                                    â”‚  â”‚  â”‚  Route Match â†’ Load Balance â†’ Relay     â”‚    â”‚   â”‚
                                    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                    â”‚                          â”‚                             â”‚
                                    â”‚                          â–¼                             â”‚
                                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                    â”‚  â”‚           MESSAGE BUFFER (ConcurrentQueue)       â”‚   â”‚
                                    â”‚  â”‚                                                   â”‚   â”‚
                                    â”‚  â”‚   [Event] [Event] [Event] [Event] [Event] ...   â”‚   â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                    â”‚                          â”‚                             â”‚
                                    â”‚                          â–¼                             â”‚
                                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                    â”‚  â”‚           PUBLISHER RUNSPACE (Dedicated)         â”‚   â”‚
                                    â”‚  â”‚                                                   â”‚   â”‚
                                    â”‚  â”‚   Batch â†’ Serialize â†’ Publish â†’ Retry           â”‚   â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                    â”‚                          â”‚                             â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                          â”‚                              â”‚
                    â–¼                                          â–¼                              â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚   Kafka   â”‚                              â”‚ RabbitMQ  â”‚                  â”‚   Redis   â”‚
             â”‚  Cluster  â”‚                              â”‚  Cluster  â”‚                  â”‚  Pub/Sub  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    REQUEST PIPELINE                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Client                                                                              Backend
    â”‚                                                                                    â”‚
    â”‚  1. TCP Connect                                                                    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Accept Connection                                           â”‚
    â”‚                              â”‚                                                     â”‚
    â”‚  2. TLS Handshake            â”‚ Check IP Blacklist                                  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶       â”‚ Check Global Rate Limit                             â”‚
    â”‚                              â”‚ SNI Certificate Selection                           â”‚
    â”‚                              â”‚                                                     â”‚
    â”‚  3. HTTP Request             â”‚                                                     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶       â”‚                                                     â”‚
    â”‚                              â–¼                                                     â”‚
    â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
    â”‚                        â”‚  Router   â”‚ Match SNI, Path, Headers                      â”‚
    â”‚                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                               â”‚
    â”‚                              â”‚                                                     â”‚
    â”‚                              â–¼                                                     â”‚
    â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
    â”‚                        â”‚ Rate Limitâ”‚ Per-route token bucket                        â”‚
    â”‚                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                               â”‚
    â”‚                              â”‚                                                     â”‚
    â”‚                              â–¼                                                     â”‚
    â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
    â”‚                        â”‚   Auth    â”‚ JWT / OAuth2 / API Key / mTLS                 â”‚
    â”‚                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                               â”‚
    â”‚                              â”‚                                                     â”‚
    â”‚                              â–¼                                                     â”‚
    â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
    â”‚                        â”‚  Circuit  â”‚ Check backend health                          â”‚
    â”‚                        â”‚  Breaker  â”‚                                               â”‚
    â”‚                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                               â”‚
    â”‚                              â”‚                                                     â”‚
    â”‚                              â–¼                                                     â”‚
    â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
    â”‚                        â”‚  Service  â”‚ Consul / etcd / K8s / DNS                     â”‚
    â”‚                        â”‚ Discovery â”‚                                               â”‚
    â”‚                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                               â”‚
    â”‚                              â”‚                                                     â”‚
    â”‚                              â–¼                                                     â”‚
    â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
    â”‚                        â”‚   Load    â”‚ Round-robin, Weighted, Locality-aware         â”‚
    â”‚                        â”‚ Balancer  â”‚                                               â”‚
    â”‚                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                               â”‚
    â”‚                              â”‚                                                     â”‚
    â”‚                              â–¼                                                     â”‚
    â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       Inject Headers                          â”‚
    â”‚                        â”‚  Traffic  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                        â”‚  Manager  â”‚       PROXY Protocol                          â”‚
    â”‚                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                               â”‚
    â”‚                              â”‚                                                     â”‚
    â”‚                              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
    â”‚                              â”‚       Response                                      â”‚
    â”‚                              â–¼                                                     â”‚
    â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
    â”‚                        â”‚  Metrics  â”‚ Latency, Status, Bytes                        â”‚
    â”‚                        â”‚  Logging  â”‚                                               â”‚
    â”‚                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                               â”‚
    â”‚                              â”‚                                                     â”‚
    â”‚                              â–¼                                                     â”‚
    â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  Message  â”‚ Async enqueue to buffer                       â”‚
    â”‚      Response          â”‚   Queue   â”‚                                               â”‚
    â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
```

### Thread Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    RUNSPACE POOL                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  HTTPS Worker 1 â”‚  â”‚  HTTPS Worker 2 â”‚  â”‚  HTTPS Worker N â”‚  â”‚  Redis Worker 1 â”‚    â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚    â”‚
â”‚  â”‚  Accept â†’ Route â”‚  â”‚  Accept â†’ Route â”‚  â”‚  Accept â†’ Route â”‚  â”‚  Parse â†’ Route  â”‚    â”‚
â”‚  â”‚  â†’ Relay â†’ Log  â”‚  â”‚  â†’ Relay â†’ Log  â”‚  â”‚  â†’ Relay â†’ Log  â”‚  â”‚  â†’ Relay â†’ Log  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                    â”‚                    â”‚                    â”‚              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                              â”‚                                                          â”‚
â”‚                              â–¼                                                          â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚                    â”‚   Message Buffer    â”‚  ConcurrentQueue<hashtable>                  â”‚
â”‚                    â”‚   (Lock-free)       â”‚                                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                               â”‚                                                         â”‚
â”‚                               â–¼                                                         â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚                    â”‚  Publisher Worker   â”‚  Dedicated runspace                          â”‚
â”‚                    â”‚                     â”‚  Batches & publishes                         â”‚
â”‚                    â”‚  Kafka / RabbitMQ   â”‚                                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Metrics Server â”‚  â”‚  Admin Server   â”‚  â”‚  Health Checker â”‚  â”‚  File Watcher   â”‚    â”‚
â”‚  â”‚     (:9090)     â”‚  â”‚     (:9091)     â”‚  â”‚  (Background)   â”‚  â”‚  (Hot Reload)   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Features

### Core Features

| Feature | Description | Status |
|---------|-------------|--------|
| TLS Termination | SNI-based routing, TLS 1.2/1.3 | âœ… Complete |
| HTTP/HTTPS Proxy | Full HTTP/1.1 support | âœ… Complete |
| WebSocket Proxy | Bidirectional relay | âœ… Complete |
| gRPC Proxy | HTTP/2 framing, service routing | âœ… Complete |
| Load Balancing | Round-robin, weighted, IP-hash, locality-aware | âœ… Complete |
| Health Checks | TCP, HTTP, gRPC health probes | âœ… Complete |
| Hot Reload | Configuration changes without restart | âœ… Complete |
| Graceful Shutdown | Connection draining | âœ… Complete |

### Security Features

| Feature | Description | Status |
|---------|-------------|--------|
| JWT Authentication | RS256, ES256, HS256 with claims validation | âœ… Complete |
| OAuth2 Introspection | RFC 7662 token validation | âœ… Complete |
| API Key Auth | Header-based key validation | âœ… Complete |
| mTLS | Client certificate validation | âœ… Complete |
| Rate Limiting | Token bucket per-IP and per-route | âœ… Complete |
| IP Blacklisting | Dynamic block list with expiry | âœ… Complete |
| Header Redaction | Sensitive data removal from logs | âœ… Complete |

### Observability Features

| Feature | Description | Status |
|---------|-------------|--------|
| Prometheus Metrics | Counters, gauges, histograms | âœ… Complete |
| Access Logging | JSON, CLF, combined formats | âœ… Complete |
| Audit Logging | Security events | âœ… Complete |
| Distributed Tracing | OpenTelemetry, Jaeger, Zipkin | âœ… Complete |
| Request Body Logging | Configurable with redaction | âœ… Complete |
| Log Rotation | Size-based with compression | âœ… Complete |

### Service Mesh Features

| Feature | Description | Status |
|---------|-------------|--------|
| Service Discovery | Consul, etcd, Kubernetes, DNS | âœ… Complete |
| Circuit Breaker | Failure detection, recovery | âœ… Complete |
| Retry Policy | Exponential backoff, budget | âœ… Complete |
| Traffic Shifting | Canary, blue-green | âœ… Complete |
| Traffic Mirroring | Shadow traffic | âœ… Complete |
| Fault Injection | Delay, abort injection | âœ… Complete |
| Distributed Rate Limiting | Redis-backed global limits | âœ… Complete |
| Locality-Aware Routing | Zone/region preference | âœ… Complete |

### Protocol Support

| Protocol | Features | Status |
|----------|----------|--------|
| HTTP/HTTPS | Full proxy with transformations | âœ… Complete |
| gRPC | Service/method routing, metadata | âœ… Complete |
| Redis | Command routing, read/write split | âœ… Complete |
| MySQL | Query routing, connection pooling | âœ… Complete |
| PostgreSQL | Basic proxy | ğŸ”„ Planned |
| MQTT | Topic routing | ğŸ”„ Planned |
| Generic TCP | Passthrough mode | âœ… Complete |

### Message Queue Integration

| System | Features | Status |
|--------|----------|--------|
| Kafka | Async publishing, batching | âœ… Complete |
| RabbitMQ | Exchange/queue routing | âœ… Complete |
| Redis Pub/Sub | Channel publishing | âœ… Complete |
| AWS SQS | Queue integration | ğŸ”„ Planned |

---

## Installation

### Prerequisites

- PowerShell 7.0+ (Windows, Linux, macOS)
- .NET 6.0+ Runtime
- TLS Certificate (PFX format)

### Quick Start

```powershell
# Clone or download the proxy script
# Create a self-signed certificate for testing
$cert = New-SelfSignedCertificate -DnsName "localhost" -CertStoreLocation "Cert:\CurrentUser\My"
Export-PfxCertificate -Cert $cert -FilePath "cert.pfx" -Password (ConvertTo-SecureString -String "password" -Force -AsPlainText)

# Start the proxy
./TLS_Proxy.ps1 -HttpsPort 8443 -CertPath "cert.pfx" -CertPassword "password"
```

### Production Installation

```powershell
# With all features enabled
./TLS_Proxy.ps1 `
    -HttpsPort 443 `
    -GrpcPort 9443 `
    -MetricsPort 9090 `
    -AdminPort 9091 `
    -WorkerCount 50 `
    -CertPath "/etc/ssl/proxy.pfx" `
    -CertPassword $env:CERT_PASSWORD `
    -RulesPath "/etc/proxy/rules.json" `
    -LogPath "/var/log/proxy" `
    -KafkaBrokers "kafka1:9092,kafka2:9092" `
    -ConsulAddr "consul.service.consul:8500" `
    -RedisAddr "redis.service.consul:6379" `
    -OtlpEndpoint "http://jaeger:4318/v1/traces" `
    -ServiceName "api-gateway" `
    -DrainTimeoutSeconds 60
```

### Docker Installation

```dockerfile
FROM mcr.microsoft.com/powershell:latest

WORKDIR /app
COPY TLS_Proxy.ps1 .
COPY rules.json .
COPY certs/ ./certs/

EXPOSE 8443 9090 9091

ENTRYPOINT ["pwsh", "-File", "TLS_Proxy.ps1"]
CMD ["-HttpsPort", "8443", "-RulesPath", "rules.json"]
```

---

## Configuration

### Configuration File Structure

```json
{
  "default": {
    "host": "127.0.0.1",
    "port": 8080
  },
  
  "routes": [],
  "loadBalancing": {},
  "rateLimit": {},
  "circuitBreaker": {},
  "auth": {},
  "logging": {},
  "tracing": {},
  "messaging": {},
  "serviceMesh": {},
  "protocols": {},
  "dns": {},
  "metrics": {},
  "admin": {},
  "hotReload": {}
}
```

### Route Configuration

```json
{
  "routes": [
    {
      "match": "api.example.com",
      "matchPath": "/v1/*",
      "backend": {
        "host": "backend-server",
        "port": 8080
      },
      "headers": {
        "X-Custom-Header": "value"
      },
      "auth": {
        "type": "jwt",
        "required": true,
        "issuer": "https://auth.example.com",
        "audience": "api.example.com",
        "algorithms": ["RS256"],
        "claims": {
          "required": ["sub", "exp"],
          "match": { "aud": "api.example.com" }
        },
        "passHeaders": {
          "X-User-Id": "sub",
          "X-User-Email": "email"
        }
      },
      "rateLimit": {
        "requestsPerSecond": 100,
        "burstSize": 200
      },
      "circuitBreaker": {
        "enabled": true,
        "failureThreshold": 5,
        "timeout": 30
      },
      "messaging": {
        "enabled": true,
        "events": ["request", "response", "error"],
        "topic": "api-events"
      },
      "logging": {
        "enabled": true,
        "logRequestBody": true,
        "maxBodySize": 65536,
        "redactHeaders": ["Authorization"]
      }
    },
    {
      "match": "*.example.com",
      "backend": {
        "service": "web-service"
      },
      "serviceMesh": {
        "enabled": true,
        "mtls": true
      }
    },
    {
      "match": "~^grpc\\.",
      "protocol": "grpc",
      "backend": {
        "cluster": "grpc-cluster"
      },
      "grpc": {
        "enabled": true,
        "services": {
          "myapp.UserService": {
            "backend": { "host": "user-service", "port": 50051 }
          }
        }
      }
    }
  ]
}
```

### Load Balancing Configuration

```json
{
  "loadBalancing": {
    "web-cluster": {
      "backends": [
        { "host": "web-1", "port": 8080, "weight": 3, "zone": "us-east-1a" },
        { "host": "web-2", "port": 8080, "weight": 2, "zone": "us-east-1b" },
        { "host": "web-3", "port": 8080, "weight": 1, "zone": "us-east-1c" }
      ],
      "strategy": "weighted-round-robin",
      "healthCheck": {
        "type": "http",
        "path": "/health",
        "interval": 10,
        "timeout": 5,
        "unhealthyThreshold": 3,
        "healthyThreshold": 2
      }
    },
    "grpc-cluster": {
      "backends": [
        { "host": "grpc-1", "port": 50051 },
        { "host": "grpc-2", "port": 50051 }
      ],
      "strategy": "round-robin",
      "healthCheck": {
        "type": "grpc",
        "service": "grpc.health.v1.Health"
      }
    }
  }
}
```

### Service Mesh Configuration

```json
{
  "serviceMesh": {
    "enabled": true,
    
    "identity": {
      "type": "spiffe",
      "trustDomain": "example.com"
    },
    
    "discovery": {
      "type": "consul",
      "consul": {
        "address": "consul:8500",
        "datacenter": "dc1",
        "register": true,
        "serviceName": "api-gateway",
        "healthCheck": {
          "http": "http://localhost:9090/health",
          "interval": "10s"
        }
      }
    },
    
    "mtls": {
      "enabled": true,
      "caCertPath": "ca.crt",
      "certPath": "service.crt",
      "keyPath": "service.key"
    },
    
    "traffic": {
      "canary": {
        "enabled": true,
        "headerRouting": { "X-Canary": "true" },
        "defaultWeight": 10
      },
      "mirroring": {
        "enabled": false,
        "target": { "service": "shadow-service" },
        "percentage": 100
      }
    },
    
    "resilience": {
      "retry": {
        "enabled": true,
        "maxAttempts": 3,
        "retryableStatusCodes": [502, 503, 504],
        "budget": {
          "enabled": true,
          "percentCanRetry": 20
        }
      },
      "circuitBreaker": {
        "enabled": true,
        "outlierDetection": {
          "enabled": true,
          "consecutiveErrors": 5,
          "baseEjectionTime": 30
        }
      }
    },
    
    "locality": {
      "enabled": true,
      "local": {
        "region": "us-east-1",
        "zone": "us-east-1a"
      }
    },
    
    "distributedRateLimit": {
      "enabled": true,
      "redis": {
        "address": "redis:6379"
      },
      "globalLimits": {
        "order-service": {
          "requestsPerSecond": 1000
        }
      }
    }
  }
}
```

### Message Queue Configuration

```json
{
  "messaging": {
    "enabled": true,
    
    "buffer": {
      "maxSize": 100000,
      "flushInterval": 1000,
      "batchSize": 100,
      "dropPolicy": "oldest"
    },
    
    "kafka": {
      "enabled": true,
      "brokers": ["kafka1:9092", "kafka2:9092"],
      "topics": {
        "requests": "proxy-requests",
        "errors": "proxy-errors",
        "audit": "proxy-audit"
      }
    },
    
    "rabbitmq": {
      "enabled": false,
      "host": "rabbitmq",
      "exchange": "proxy-events"
    },
    
    "eventSchema": {
      "includeTimestamp": true,
      "includeRequestId": true,
      "includeLatency": true,
      "customFields": {
        "environment": "production",
        "datacenter": "us-east-1"
      }
    }
  }
}
```

---

## Components

### Rate Limiter

Token bucket algorithm with configurable refill rate:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TOKEN BUCKET                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   Capacity: 200 tokens (burst size)                         â”‚
â”‚   Refill Rate: 100 tokens/second                            â”‚
â”‚                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â—  â”‚   â”‚
â”‚   â”‚ â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â—  â”‚   â”‚
â”‚   â”‚ â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â— â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹  â”‚   â”‚
â”‚   â”‚ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚   â— = Available token    â—‹ = Used token                     â”‚
â”‚                                                              â”‚
â”‚   Request arrives:                                           â”‚
â”‚   1. Calculate tokens to add since last request              â”‚
â”‚   2. If tokens >= 1, consume and allow                       â”‚
â”‚   3. Else, reject with 429 and Retry-After header           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Circuit Breaker

State machine protecting backends from cascading failures:

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚    CLOSED     â”‚
                         â”‚   (Normal)    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    Failure count >= threshold
                                 â”‚
                                 â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     OPEN      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚          â”‚  (Rejecting)  â”‚          â”‚
              â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
              â”‚                                     â”‚
         Any failure                         Timeout expires
              â”‚                                     â”‚
              â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   HALF-OPEN   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚  (Testing)    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    Success count >= threshold
                                 â”‚
                                 â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚    CLOSED     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Message Buffer

Lock-free concurrent queue with backpressure:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MESSAGE BUFFER                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  PRODUCERS (Worker Runspaces)                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚Worker 1 â”‚ â”‚Worker 2 â”‚ â”‚Worker 3 â”‚ â”‚Worker N â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                            â”‚
â”‚       â”‚           â”‚           â”‚           â”‚                                  â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                         â”‚                                                    â”‚
â”‚                         â–¼ Enqueue (Lock-free)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  CONCURRENT QUEUE                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Evt â”‚ Evt â”‚ Evt â”‚ Evt â”‚ Evt â”‚ Evt â”‚ Evt â”‚ Evt â”‚ Evt â”‚ ... â”‚     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  Max Size: 100,000 events                                              â”‚  â”‚
â”‚  â”‚  Current:  45,230 events                                               â”‚  â”‚
â”‚  â”‚  Backpressure: OFF                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                                    â”‚
â”‚                         â–¼ TryDequeue (Batched)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  CONSUMER (Publisher Runspace)                                          â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚  1. Dequeue up to 100 events                                            â”‚â”‚
â”‚  â”‚  2. Group by event type                                                  â”‚â”‚
â”‚  â”‚  3. Serialize to JSON                                                   â”‚â”‚
â”‚  â”‚  4. Publish to Kafka/RabbitMQ                                           â”‚â”‚
â”‚  â”‚  5. On failure, re-queue with retry count                               â”‚â”‚
â”‚  â”‚  6. Sleep until next flush interval                                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  BACKPRESSURE HANDLING:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  When buffer size >= maxSize:                                           â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚  Policy: "oldest"  â†’ Dequeue oldest, enqueue new                        â”‚â”‚
â”‚  â”‚  Policy: "newest"  â†’ Reject new event                                    â”‚â”‚
â”‚  â”‚  Policy: "block"   â†’ Brief wait, then reject                            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Protocols

### Redis Protocol

Read/write splitting with command classification:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          REDIS PROTOCOL HANDLER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  CLIENT                           PROXY                          BACKENDS   â”‚
â”‚    â”‚                                â”‚                                â”‚       â”‚
â”‚    â”‚  GET user:123                  â”‚                                â”‚       â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                â”‚       â”‚
â”‚    â”‚                                â”‚ Parse RESP                     â”‚       â”‚
â”‚    â”‚                                â”‚ Classify: READ                 â”‚       â”‚
â”‚    â”‚                                â”‚ Route to: REPLICA              â”‚       â”‚
â”‚    â”‚                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚       â”‚
â”‚    â”‚                                â”‚                   replica-1    â”‚       â”‚
â”‚    â”‚                                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                â”‚       â”‚
â”‚    â”‚  $5\r\nvalue\r\n               â”‚                                â”‚       â”‚
â”‚    â”‚                                â”‚                                â”‚       â”‚
â”‚    â”‚  SET user:123 "data"           â”‚                                â”‚       â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                â”‚       â”‚
â”‚    â”‚                                â”‚ Parse RESP                     â”‚       â”‚
â”‚    â”‚                                â”‚ Classify: WRITE                â”‚       â”‚
â”‚    â”‚                                â”‚ Route to: PRIMARY              â”‚       â”‚
â”‚    â”‚                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚       â”‚
â”‚    â”‚                                â”‚                   primary      â”‚       â”‚
â”‚    â”‚                                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                â”‚       â”‚
â”‚    â”‚  +OK\r\n                       â”‚                                â”‚       â”‚
â”‚    â”‚                                â”‚                                â”‚       â”‚
â”‚    â”‚  FLUSHALL                      â”‚                                â”‚       â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                â”‚       â”‚
â”‚    â”‚                                â”‚ Parse RESP                     â”‚       â”‚
â”‚    â”‚                                â”‚ Classify: ADMIN                â”‚       â”‚
â”‚    â”‚                                â”‚ BLOCKED!                       â”‚       â”‚
â”‚    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                â”‚       â”‚
â”‚    â”‚  -ERR Command not allowed      â”‚                                â”‚       â”‚
â”‚                                                                              â”‚
â”‚  COMMAND CLASSIFICATION:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ READ:  GET, MGET, HGET, LRANGE, SMEMBERS, ZRANGE, EXISTS, TTL, SCAN   â”‚ â”‚
â”‚  â”‚ WRITE: SET, MSET, HSET, LPUSH, SADD, ZADD, DEL, EXPIRE, INCR          â”‚ â”‚
â”‚  â”‚ ADMIN: FLUSHALL, FLUSHDB, DEBUG, CONFIG, SHUTDOWN, SLAVEOF            â”‚ â”‚
â”‚  â”‚ DANGEROUS: KEYS, EVAL, EVALSHA, SCRIPT                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### gRPC Protocol

Service and method-level routing:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          gRPC PROTOCOL HANDLER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  REQUEST PATH: /myapp.UserService/GetUser                                    â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜                                   â”‚
â”‚                     Service       Method                                     â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  SERVICE ROUTING TABLE                                                   â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  Service                  â”‚ Backend           â”‚ Config                   â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  myapp.UserService        â”‚ user-service:50051â”‚ timeout=5s              â”‚â”‚
â”‚  â”‚  myapp.OrderService       â”‚ cluster:orders    â”‚ timeout=30s, auth=true  â”‚â”‚
â”‚  â”‚  myapp.PaymentService     â”‚ payment:50051     â”‚ mtls=true               â”‚â”‚
â”‚  â”‚  grpc.health.v1.Health    â”‚ (local)           â”‚ internal                â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  gRPC FRAME FORMAT:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚Compress â”‚     Message Length      â”‚            Message Data              â”‚â”‚
â”‚  â”‚ (1 byte)â”‚       (4 bytes)         â”‚           (N bytes)                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  METADATA INJECTION:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  x-request-id: {generated}                                              â”‚ â”‚
â”‚  â”‚  x-client-ip: {client_ip}                                               â”‚ â”‚
â”‚  â”‚  x-forwarded-for: {client_ip}                                           â”‚ â”‚
â”‚  â”‚  authorization: {forwarded from client}                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  gRPC STATUS CODES:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  0  OK              â”‚  7  PERMISSION_DENIED  â”‚  13 INTERNAL             â”‚ â”‚
â”‚  â”‚  1  CANCELLED       â”‚  8  RESOURCE_EXHAUSTED â”‚  14 UNAVAILABLE          â”‚ â”‚
â”‚  â”‚  2  UNKNOWN         â”‚  9  FAILED_PRECONDITIONâ”‚  15 DATA_LOSS            â”‚ â”‚
â”‚  â”‚  3  INVALID_ARGUMENTâ”‚  10 ABORTED            â”‚  16 UNAUTHENTICATED      â”‚ â”‚
â”‚  â”‚  4  DEADLINE_EXCEED â”‚  11 OUT_OF_RANGE       â”‚                          â”‚ â”‚
â”‚  â”‚  5  NOT_FOUND       â”‚  12 UNIMPLEMENTED      â”‚                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### GraphQL Protocol

Query parsing with complexity analysis:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GRAPHQL PROTOCOL HANDLER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  QUERY ANALYSIS:                                                             â”‚
â”‚                                                                              â”‚
â”‚  query GetUserWithPosts($id: ID!) {                                          â”‚
â”‚    user(id: $id) {              â† Depth: 1, Cost: 1                          â”‚
â”‚      name                       â† Depth: 2, Cost: 1                          â”‚
â”‚      email                      â† Depth: 2, Cost: 1                          â”‚
â”‚      posts {                    â† Depth: 2, Cost: 10 (list multiplier)       â”‚
â”‚        title                    â† Depth: 3, Cost: 1                          â”‚
â”‚        comments {               â† Depth: 3, Cost: 10 (list multiplier)       â”‚
â”‚          author                 â† Depth: 4, Cost: 1                          â”‚
â”‚        }                                                                     â”‚
â”‚      }                                                                       â”‚
â”‚    }                                                                         â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  Total Depth: 4                                                              â”‚
â”‚  Total Complexity: 1 + 1 + 1 + 10 + 1 + 10 + 1 = 25                         â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  VALIDATION RULES                                                        â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  Max Depth:      10      â”‚ Reject if depth > 10                         â”‚â”‚
â”‚  â”‚  Max Complexity: 1000    â”‚ Reject if complexity > 1000                  â”‚â”‚
â”‚  â”‚  Max Query Size: 100KB   â”‚ Reject oversized queries                     â”‚â”‚
â”‚  â”‚  Introspection:  true    â”‚ Allow __schema queries                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  OPERATION-SPECIFIC RATE LIMITING:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Query.users         â”‚ 10 req/sec  â”‚ List operations are expensive      â”‚â”‚
â”‚  â”‚  Query.user          â”‚ 100 req/sec â”‚ Single lookups are cheap           â”‚â”‚
â”‚  â”‚  Mutation.*          â”‚ 5 req/sec   â”‚ Mutations need protection          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  PERSISTED QUERIES:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Client sends:  { "extensions": { "persistedQuery": { "sha256Hash":     â”‚â”‚
â”‚  â”‚                    "abc123..." } } }                                     â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚  Proxy looks up hash â†’ Returns cached query                              â”‚â”‚
â”‚  â”‚  Benefits: Reduced bandwidth, prevents arbitrary queries                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Service Mesh

### Service Discovery Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SERVICE DISCOVERY                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  CONSUL INTEGRATION:                                                         â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  TLS Proxy  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Consul    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Services   â”‚            â”‚
â”‚  â”‚             â”‚  HTTP   â”‚   Agent     â”‚  Gossip â”‚             â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚  1. Register on startup                                            â”‚
â”‚         â”‚     PUT /v1/agent/service/register                                 â”‚
â”‚         â”‚     { "ID": "proxy-1", "Name": "api-gateway", ... }               â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚  2. Query healthy endpoints                                        â”‚
â”‚         â”‚     GET /v1/health/service/order-service?passing=true             â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚  3. Watch for changes (long-poll or blocking query)               â”‚
â”‚         â”‚     GET /v1/health/service/order-service?index=123&wait=30s       â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚  4. Deregister on shutdown                                         â”‚
â”‚         â”‚     PUT /v1/agent/service/deregister/proxy-1                       â”‚
â”‚                                                                              â”‚
â”‚  SERVICE CACHE:                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Service           â”‚ Endpoints              â”‚ TTL     â”‚ Last Update     â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  order-service     â”‚ 10.0.0.1:8080 (w=3)   â”‚ 30s     â”‚ 2024-01-15 10:30â”‚â”‚
â”‚  â”‚                    â”‚ 10.0.0.2:8080 (w=2)   â”‚         â”‚                  â”‚â”‚
â”‚  â”‚  user-service      â”‚ 10.0.1.1:8080         â”‚ 30s     â”‚ 2024-01-15 10:29â”‚â”‚
â”‚  â”‚  payment-service   â”‚ 10.0.2.1:8080         â”‚ 30s     â”‚ 2024-01-15 10:28â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Traffic Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          TRAFFIC MANAGEMENT                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  CANARY DEPLOYMENT:                                                          â”‚
â”‚                                                                              â”‚
â”‚     100% Traffic                                                             â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                               â”‚
â”‚    â”‚ Router  â”‚                                                               â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                               â”‚
â”‚         â”‚                                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                                               â”‚
â”‚    â”‚         â”‚                                                               â”‚
â”‚    â–¼         â–¼                                                               â”‚
â”‚   90%       10%                                                              â”‚
â”‚    â”‚         â”‚                                                               â”‚
â”‚    â–¼         â–¼                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”                                                             â”‚
â”‚ â”‚ v1  â”‚  â”‚ v2  â”‚  â† Canary                                                   â”‚
â”‚ â”‚     â”‚  â”‚     â”‚                                                             â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜                                                             â”‚
â”‚                                                                              â”‚
â”‚  HEADER-BASED ROUTING:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  X-Canary: true  â†’ Route to v2 (canary)                                 â”‚â”‚
â”‚  â”‚  X-Version: v2   â†’ Route to v2                                           â”‚â”‚
â”‚  â”‚  No header       â†’ Route based on weight percentage                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  TRAFFIC MIRRORING (Shadow Traffic):                                         â”‚
â”‚                                                                              â”‚
â”‚     Request                                                                  â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                               â”‚
â”‚    â”‚  Proxy  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚                                               â”‚
â”‚         â”‚                    â”‚ Fire-and-forget                               â”‚
â”‚         â–¼                    â–¼                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚    â”‚ Primary â”‚          â”‚ Shadow  â”‚                                          â”‚
â”‚    â”‚ Backend â”‚          â”‚ Backend â”‚                                          â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚         â”‚                    â”‚                                               â”‚
â”‚         â–¼                    âœ— Response discarded                            â”‚
â”‚     Response                                                                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Locality-Aware Routing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       LOCALITY-AWARE ROUTING                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  PROXY LOCATION: us-east-1a                                                  â”‚
â”‚                                                                              â”‚
â”‚  ENDPOINT SELECTION PRIORITY:                                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Priority â”‚ Locality      â”‚ Weight â”‚ Endpoints                          â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  1 (High) â”‚ Same Zone     â”‚ 100    â”‚ 10.0.0.1 (us-east-1a)              â”‚â”‚
â”‚  â”‚           â”‚ us-east-1a    â”‚        â”‚ 10.0.0.2 (us-east-1a)              â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  2 (Med)  â”‚ Same Region   â”‚ 50     â”‚ 10.0.1.1 (us-east-1b)              â”‚â”‚
â”‚  â”‚           â”‚ us-east-1*    â”‚        â”‚ 10.0.1.2 (us-east-1c)              â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  3 (Low)  â”‚ Any           â”‚ 1      â”‚ 10.0.2.1 (us-west-2a)              â”‚â”‚
â”‚  â”‚           â”‚               â”‚        â”‚ 10.0.2.2 (eu-west-1a)              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  FAILOVER:                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  1. Prefer same-zone endpoints (lowest latency)                         â”‚â”‚
â”‚  â”‚  2. If same-zone < 70% capacity, include same-region                    â”‚â”‚
â”‚  â”‚  3. If same-region unavailable, fall back to any zone                   â”‚â”‚
â”‚  â”‚  4. Never route to unhealthy endpoints                                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Message Queue Integration

### Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MESSAGE QUEUE ARCHITECTURE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  REQUEST PROCESSING                          MESSAGE PUBLISHING              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Worker    â”‚â”€â”€â”€â–¶â”‚   Message Buffer    â”‚â”€â”€â”€â–¶â”‚   Publisher Runspace    â”‚  â”‚
â”‚  â”‚  Runspace   â”‚    â”‚  (ConcurrentQueue)  â”‚    â”‚                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚                                                 â”‚  â”‚  Kafka Producer â”‚    â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚   Worker    â”‚â”€â”€â”€â–¶                           â”‚           â”‚             â”‚  â”‚
â”‚  â”‚  Runspace   â”‚                               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚  â”‚ RabbitMQ Prod.  â”‚    â”‚  â”‚
â”‚                                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚           â”‚             â”‚  â”‚
â”‚  â”‚   Worker    â”‚â”€â”€â”€â–¶                           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  Runspace   â”‚                               â”‚  â”‚  Redis Pub/Sub  â”‚    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  EVENT FLOW:                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚  1. Request completes in worker                                          â”‚â”‚
â”‚  â”‚  2. Worker creates event hashtable                                       â”‚â”‚
â”‚  â”‚  3. Worker calls Add-MessageToBuffer (lock-free enqueue)                â”‚â”‚
â”‚  â”‚  4. Publisher wakes on interval (1 second default)                       â”‚â”‚
â”‚  â”‚  5. Publisher dequeues batch (100 events max)                           â”‚â”‚
â”‚  â”‚  6. Publisher groups by event type                                       â”‚â”‚
â”‚  â”‚  7. Publisher serializes to JSON                                        â”‚â”‚
â”‚  â”‚  8. Publisher sends to Kafka/RabbitMQ/Redis                             â”‚â”‚
â”‚  â”‚  9. On failure, re-queue with retry count                               â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event Schema

```json
{
  "event_type": "requests",
  "timestamp": "2024-01-15T10:30:45.123Z",
  "request_id": "a1b2c3d4e5f6",
  "proxy_id": "api-gateway-prod-1",
  
  "client": {
    "ip": "192.168.1.100",
    "port": 54321,
    "user_agent": "Mozilla/5.0..."
  },
  
  "request": {
    "method": "POST",
    "path": "/api/v1/orders",
    "host": "api.example.com",
    "content_type": "application/json",
    "content_length": 256
  },
  
  "response": {
    "status_code": 201,
    "content_length": 128,
    "latency_ms": 45.23
  },
  
  "routing": {
    "route": "api.example.com",
    "backend": "10.0.0.1:8080",
    "service": "order-service",
    "version": "v1"
  },
  
  "auth": {
    "method": "jwt",
    "user_id": "user-123",
    "success": true
  },
  
  "tls": {
    "version": "TLS1.3",
    "cipher": "TLS_AES_256_GCM_SHA384",
    "sni": "api.example.com"
  },
  
  "custom": {
    "environment": "production",
    "datacenter": "us-east-1"
  }
}
```

### Downstream Consumers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DOWNSTREAM CONSUMERS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                           KAFKA TOPICS                                       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  proxy-requests  â”‚    â”‚   proxy-errors   â”‚    â”‚   proxy-audit    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚           â”‚                       â”‚                       â”‚                  â”‚
â”‚           â–¼                       â–¼                       â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚â”‚
â”‚  â”‚  â”‚ Elasticsearchâ”‚  â”‚   Flink     â”‚  â”‚   Splunk    â”‚  â”‚    S3       â”‚     â”‚â”‚
â”‚  â”‚  â”‚   (Logs)    â”‚  â”‚ (Analytics) â”‚  â”‚  (SIEM)     â”‚  â”‚ (Archive)   â”‚     â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â”‚
â”‚  â”‚        â”‚                â”‚                â”‚                â”‚              â”‚â”‚
â”‚  â”‚        â–¼                â–¼                â–¼                â–¼              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚â”‚
â”‚  â”‚  â”‚  Kibana   â”‚    â”‚ Dashboard â”‚    â”‚  Alerts   â”‚    â”‚ Athena    â”‚       â”‚â”‚
â”‚  â”‚  â”‚   UI      â”‚    â”‚           â”‚    â”‚           â”‚    â”‚ Queries   â”‚       â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  USE CASES:                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  â€¢ Real-time dashboards: Request rates, latency percentiles             â”‚â”‚
â”‚  â”‚  â€¢ Anomaly detection: Unusual traffic patterns, auth failures           â”‚â”‚
â”‚  â”‚  â€¢ Compliance auditing: Who accessed what, when                         â”‚â”‚
â”‚  â”‚  â€¢ Debugging: Trace requests through the system                         â”‚â”‚
â”‚  â”‚  â€¢ Billing: Usage-based pricing, API call counting                      â”‚â”‚
â”‚  â”‚  â€¢ Capacity planning: Traffic forecasting, scaling decisions            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Operations

### Command Line Parameters

| Parameter | Default | Description |
|-----------|---------|-------------|
| `-HttpsPort` | 8443 | HTTPS listener port |
| `-GrpcPort` | 9443 | Dedicated gRPC port (optional) |
| `-TcpPort` | 9999 | Generic TCP proxy port |
| `-DotPort` | 853 | DNS over TLS port |
| `-MetricsPort` | 9090 | Prometheus metrics port |
| `-AdminPort` | 9091 | Admin API port |
| `-WorkerCount` | 15 | Number of worker runspaces |
| `-CertPath` | cert.pfx | TLS certificate path |
| `-CertPassword` | password | Certificate password |
| `-RulesPath` | rules.json | Configuration file path |
| `-LogPath` | logs | Log directory |
| `-BufferSize` | 65536 | Network buffer size |
| `-TimeoutMs` | 30000 | Request timeout |
| `-DrainTimeoutSeconds` | 30 | Graceful shutdown timeout |
| `-KafkaBrokers` | | Kafka broker addresses |
| `-ConsulAddr` | | Consul agent address |
| `-RedisAddr` | | Redis address for distributed state |
| `-OtlpEndpoint` | | OpenTelemetry collector endpoint |
| `-ServiceName` | tls-proxy | Service name for registration |
| `-ServiceId` | | Unique service instance ID |

### Admin API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/admin/status` | GET | Proxy status and stats |
| `/admin/reload` | POST | Reload configuration |
| `/admin/drain` | POST | Start connection draining |
| `/admin/resume` | POST | Resume accepting connections |
| `/admin/circuits` | GET | Circuit breaker states |
| `/admin/circuits/reset` | POST | Reset all circuit breakers |
| `/admin/services` | GET | Discovered services |
| `/admin/services/{name}` | GET | Endpoints for a service |
| `/admin/messaging` | GET | Message buffer stats |
| `/admin/blacklist` | GET/POST/DELETE | IP blacklist management |

### Example Admin Commands

```bash
# Check proxy status
curl http://localhost:9091/admin/status | jq .

# Reload configuration
curl -X POST http://localhost:9091/admin/reload

# Start graceful shutdown
curl -X POST http://localhost:9091/admin/drain

# View circuit breaker states
curl http://localhost:9091/admin/circuits | jq .

# Reset circuit breakers
curl -X POST http://localhost:9091/admin/circuits/reset

# Block an IP for 1 hour
curl -X POST http://localhost:9091/admin/blacklist \
  -H "Content-Type: application/json" \
  -d '{"ip": "1.2.3.4", "duration": 3600, "reason": "abuse"}'

# View discovered services
curl http://localhost:9091/admin/services | jq .

# Get endpoints for a service
curl http://localhost:9091/admin/services/order-service | jq .

# Check message queue buffer
curl http://localhost:9091/admin/messaging | jq .
```

---

## Metrics & Monitoring

### Prometheus Metrics

```
# Connection metrics
tls_proxy_connections_total          # Total connections accepted
tls_proxy_connections_active         # Currently active connections
tls_proxy_requests_total             # Total requests processed

# Data transfer
tls_proxy_bytes_in_total             # Total bytes received
tls_proxy_bytes_out_total            # Total bytes sent

# Security
tls_proxy_rate_limited_total         # Requests rejected by rate limiter
tls_proxy_auth_success_total         # Successful authentications
tls_proxy_auth_failure_total         # Failed authentications

# Reliability
tls_proxy_circuit_open_total         # Circuit breaker open events
tls_proxy_backend_errors_total       # Backend connection failures
tls_proxy_timeout_errors_total       # Request timeouts

# Messaging
tls_proxy_message_buffer_size        # Current message buffer size
tls_proxy_messages_published_total   # Messages published to queues
tls_proxy_messages_dropped_total     # Messages dropped due to backpressure

# Protocol-specific
tls_proxy_redis_commands_total       # Redis commands proxied
tls_proxy_mysql_queries_total        # MySQL queries proxied
tls_proxy_grpc_requests_total        # gRPC requests proxied
tls_proxy_graphql_queries_total      # GraphQL queries processed

# Status
tls_proxy_draining                   # 1 if draining, 0 otherwise
tls_proxy_rules_version              # Current configuration version
```

### Grafana Dashboard Queries

```promql
# Request rate
rate(tls_proxy_requests_total[5m])

# Error rate
rate(tls_proxy_backend_errors_total[5m]) / rate(tls_proxy_requests_total[5m])

# P99 latency (requires histogram)
histogram_quantile(0.99, rate(tls_proxy_request_duration_seconds_bucket[5m]))

# Active connections
tls_proxy_connections_active

# Rate limiting pressure
rate(tls_proxy_rate_limited_total[5m]) / rate(tls_proxy_requests_total[5m])

# Message queue backlog
tls_proxy_message_buffer_size

# Circuit breaker health
sum(tls_proxy_circuit_open_total) by (backend)
```

### Alerting Rules

```yaml
groups:
  - name: tls-proxy
    rules:
      - alert: HighErrorRate
        expr: rate(tls_proxy_backend_errors_total[5m]) / rate(tls_proxy_requests_total[5m]) > 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: High error rate on TLS proxy
          
      - alert: CircuitBreakerOpen
        expr: increase(tls_proxy_circuit_open_total[5m]) > 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: Circuit breaker opened
          
      - alert: MessageBufferBackpressure
        expr: tls_proxy_message_buffer_size > 50000
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: Message buffer approaching capacity
          
      - alert: HighRateLimiting
        expr: rate(tls_proxy_rate_limited_total[5m]) > 100
        for: 5m
        labels:
          severity: info
        annotations:
          summary: High rate limiting activity
```

---

## Security

### TLS Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          TLS CONFIGURATION                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  SUPPORTED PROTOCOLS:                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  âœ… TLS 1.3 (Preferred)                                                 â”‚â”‚
â”‚  â”‚  âœ… TLS 1.2 (Supported)                                                 â”‚â”‚
â”‚  â”‚  âŒ TLS 1.1 (Disabled)                                                  â”‚â”‚
â”‚  â”‚  âŒ TLS 1.0 (Disabled)                                                  â”‚â”‚
â”‚  â”‚  âŒ SSLv3  (Disabled)                                                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  SNI-BASED CERTIFICATE SELECTION:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Client SNI              â”‚ Certificate                                  â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  api.example.com         â”‚ certs/api.example.com.pfx                    â”‚â”‚
â”‚  â”‚  www.example.com         â”‚ certs/www.example.com.pfx                    â”‚â”‚
â”‚  â”‚  *.internal.example.com  â”‚ certs/wildcard.internal.pfx                  â”‚â”‚
â”‚  â”‚  (default)               â”‚ cert.pfx                                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  mTLS (CLIENT CERTIFICATES):                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  â€¢ Enabled per-route via auth.type = "mtls"                             â”‚â”‚
â”‚  â”‚  â€¢ Validate CN against allowedCNs list                                  â”‚â”‚
â”‚  â”‚  â€¢ Validate OU against allowedOUs list                                  â”‚â”‚
â”‚  â”‚  â€¢ Check certificate expiry                                              â”‚â”‚
â”‚  â”‚  â€¢ Optional CRL verification                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AUTHENTICATION FLOW                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  JWT AUTHENTICATION:                                                         â”‚
â”‚                                                                              â”‚
â”‚  Client                    Proxy                      Backend                â”‚
â”‚    â”‚                         â”‚                           â”‚                   â”‚
â”‚    â”‚  Authorization: Bearer eyJ...                       â”‚                   â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                           â”‚                   â”‚
â”‚    â”‚                         â”‚                           â”‚                   â”‚
â”‚    â”‚                         â”‚ 1. Split JWT header.payload.signature        â”‚
â”‚    â”‚                         â”‚ 2. Decode payload (base64url)                â”‚
â”‚    â”‚                         â”‚ 3. Validate exp > now                        â”‚
â”‚    â”‚                         â”‚ 4. Validate iss matches config               â”‚
â”‚    â”‚                         â”‚ 5. Validate aud matches config               â”‚
â”‚    â”‚                         â”‚ 6. Extract claims (sub, email, roles)        â”‚
â”‚    â”‚                         â”‚                           â”‚                   â”‚
â”‚    â”‚                         â”‚  X-User-Id: user-123      â”‚                   â”‚
â”‚    â”‚                         â”‚  X-User-Email: u@e.com    â”‚                   â”‚
â”‚    â”‚                         â”‚  X-Auth-Method: jwt       â”‚                   â”‚
â”‚    â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚
â”‚    â”‚                         â”‚                           â”‚                   â”‚
â”‚    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                         â”‚                           â”‚                   â”‚
â”‚                                                                              â”‚
â”‚  OAUTH2 INTROSPECTION:                                                       â”‚
â”‚                                                                              â”‚
â”‚  Client                    Proxy                   Auth Server               â”‚
â”‚    â”‚                         â”‚                           â”‚                   â”‚
â”‚    â”‚  Authorization: Bearer opaque-token                 â”‚                   â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                           â”‚                   â”‚
â”‚    â”‚                         â”‚                           â”‚                   â”‚
â”‚    â”‚                         â”‚  POST /oauth/introspect   â”‚                   â”‚
â”‚    â”‚                         â”‚  token=opaque-token       â”‚                   â”‚
â”‚    â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚
â”‚    â”‚                         â”‚                           â”‚                   â”‚
â”‚    â”‚                         â”‚  { "active": true,        â”‚                   â”‚
â”‚    â”‚                         â”‚    "sub": "user-123",     â”‚                   â”‚
â”‚    â”‚                         â”‚    "scope": "read write"} â”‚                   â”‚
â”‚    â”‚                         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚    â”‚                         â”‚                           â”‚                   â”‚
â”‚    â”‚                         â”‚ Cache result (TTL: 5min)  â”‚                   â”‚
â”‚    â”‚                         â”‚                           â”‚                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Security Best Practices

1. **TLS Configuration**
   - Use TLS 1.3 where possible
   - Disable weak cipher suites
   - Enable OCSP stapling
   - Use strong certificates (RSA 2048+ or ECDSA P-256+)

2. **Authentication**
   - Prefer JWT with short expiry (15-60 minutes)
   - Use OAuth2 introspection for opaque tokens
   - Enable mTLS for service-to-service communication
   - Rotate API keys regularly

3. **Rate Limiting**
   - Set appropriate limits per route
   - Use distributed rate limiting for multi-instance deployments
   - Monitor rate limiting metrics for attacks

4. **Logging**
   - Redact sensitive headers (Authorization, Cookie)
   - Enable audit logging for security events
   - Ship logs to centralized SIEM

5. **Network**
   - Run proxy in private subnet
   - Use IP whitelisting for admin endpoints
   - Enable IP blacklisting for abuse prevention

---

## Performance Tuning

### Worker Pool Sizing

```
Recommended workers = (CPU cores Ã— 2) + 1

Example:
- 4 core machine: 9 workers
- 8 core machine: 17 workers
- 16 core machine: 33 workers

For I/O-heavy workloads (slow backends):
workers = CPU cores Ã— 4
```

### Buffer Sizes

| Parameter | Default | High Throughput | Low Latency |
|-----------|---------|-----------------|-------------|
| BufferSize | 65536 | 131072 | 32768 |
| Message Buffer Max | 100000 | 500000 | 50000 |
| Batch Size | 100 | 500 | 50 |
| Flush Interval | 1000ms | 5000ms | 100ms |

### Connection Pooling

```json
{
  "protocols": {
    "redis": {
      "pool": {
        "maxConnections": 100,
        "minConnections": 10,
        "maxIdleTime": 300
      }
    },
    "mysql": {
      "pool": {
        "maxConnections": 100,
        "minConnections": 10,
        "testOnBorrow": true
      }
    }
  }
}
```

### OS Tuning (Linux)

```bash
# Increase file descriptor limit
echo "* soft nofile 65535" >> /etc/security/limits.conf
echo "* hard nofile 65535" >> /etc/security/limits.conf

# Network tuning
sysctl -w net.core.somaxconn=65535
sysctl -w net.ipv4.tcp_max_syn_backlog=65535
sysctl -w net.core.netdev_max_backlog=65535
sysctl -w net.ipv4.tcp_fin_timeout=30
sysctl -w net.ipv4.tcp_keepalive_time=300
```

---

## Troubleshooting

### Common Issues

| Issue | Symptom | Solution |
|-------|---------|----------|
| TLS Handshake Failure | `AuthenticationException` | Check certificate validity, supported protocols |
| Backend Connection Refused | `SocketException` | Verify backend is running, check firewall rules |
| Rate Limiting | 429 responses | Increase limits or whitelist IPs |
| Circuit Breaker Open | 503 responses | Check backend health, reset circuit breaker |
| Message Buffer Full | Events dropped | Increase buffer size or add Kafka partitions |
| High Latency | Slow responses | Check backend health, increase workers |

### Debug Mode

```powershell
# Enable verbose logging
./TLS_Proxy.ps1 -LogLevel debug

# Check worker status
curl http://localhost:9091/admin/status | jq .

# View circuit breaker states
curl http://localhost:9091/admin/circuits | jq .

# Check message buffer
curl http://localhost:9091/admin/messaging | jq .

# Tail access logs
tail -f logs/access.log | jq .

# Tail error logs
tail -f logs/error.log
```

### Health Checks

```bash
# Basic health check
curl http://localhost:9090/health

# Prometheus metrics
curl http://localhost:9090/metrics | grep tls_proxy

# Backend health
curl http://localhost:9091/admin/services/order-service | jq '.endpoints[].healthy'
```

---

## Future Enhancements

### Planned Features

| Feature | Priority | Description | Status |
|---------|----------|-------------|--------|
| **HTTP/2 Support** | High | Full HTTP/2 multiplexing for non-gRPC traffic | ğŸ”„ Planned |
| **HTTP/3 (QUIC)** | Medium | QUIC protocol support for improved performance | ğŸ”„ Planned |
| **Let's Encrypt Integration** | High | Automatic certificate provisioning via ACME | ğŸ”„ Planned |
| **WebAssembly Filters** | Medium | WASM-based request/response transformations | ğŸ”„ Planned |
| **Lua Scripting** | Medium | Lua scripts for custom routing logic | ğŸ”„ Planned |
| **PostgreSQL Protocol** | Medium | PostgreSQL wire protocol support | ğŸ”„ Planned |
| **MQTT Protocol** | Low | IoT message broker proxying | ğŸ”„ Planned |
| **AWS SQS Integration** | Medium | SQS as message queue backend | ğŸ”„ Planned |
| **GeoIP Routing** | Medium | Route based on client location | ğŸ”„ Planned |
| **Request Replay** | Low | Replay failed requests from queue | ğŸ”„ Planned |
| **A/B Testing Framework** | Medium | Built-in experiment management | ğŸ”„ Planned |
| **API Versioning** | Low | Automatic version negotiation | ğŸ”„ Planned |

### HTTP/2 Support Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          HTTP/2 SUPPORT (PLANNED)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  FEATURES:                                                                   â”‚
â”‚  â€¢ Full multiplexing (multiple requests per connection)                      â”‚
â”‚  â€¢ Header compression (HPACK)                                                â”‚
â”‚  â€¢ Server push support                                                       â”‚
â”‚  â€¢ Stream prioritization                                                     â”‚
â”‚  â€¢ Flow control per stream                                                   â”‚
â”‚                                                                              â”‚
â”‚  ARCHITECTURE:                                                               â”‚
â”‚                                                                              â”‚
â”‚     Client â”€â”€â”€â”€ HTTP/2 â”€â”€â”€â”€â–¶ Proxy â”€â”€â”€â”€ HTTP/2 â”€â”€â”€â”€â–¶ Backend                â”‚
â”‚                               â”‚                                              â”‚
â”‚                               â”‚ OR                                           â”‚
â”‚                               â”‚                                              â”‚
â”‚     Client â”€â”€â”€â”€ HTTP/2 â”€â”€â”€â”€â–¶ Proxy â”€â”€â”€â”€ HTTP/1.1 â”€â”€â–¶ Backend                â”‚
â”‚                                                                              â”‚
â”‚  CONFIGURATION:                                                              â”‚
â”‚  {                                                                           â”‚
â”‚    "http2": {                                                                â”‚
â”‚      "enabled": true,                                                        â”‚
â”‚      "maxConcurrentStreams": 100,                                            â”‚
â”‚      "maxFrameSize": 16384,                                                  â”‚
â”‚      "maxHeaderListSize": 8192,                                              â”‚
â”‚      "initialWindowSize": 65535                                              â”‚
â”‚    }                                                                         â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Let's Encrypt Integration Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     LET'S ENCRYPT INTEGRATION (PLANNED)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  AUTOMATIC CERTIFICATE MANAGEMENT:                                           â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  TLS Proxy  â”‚â—€â”€â”€â”€â–¶â”‚ ACME Client â”‚â—€â”€â”€â”€â–¶â”‚ Let's Encryptâ”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚  1. Check certificate expiry (daily)                               â”‚
â”‚         â”‚  2. If expires in < 30 days, request renewal                       â”‚
â”‚         â”‚  3. Complete HTTP-01 or DNS-01 challenge                          â”‚
â”‚         â”‚  4. Store new certificate                                          â”‚
â”‚         â”‚  5. Hot-reload certificate (no restart)                           â”‚
â”‚         â”‚                                                                    â”‚
â”‚  CONFIGURATION:                                                              â”‚
â”‚  {                                                                           â”‚
â”‚    "acme": {                                                                 â”‚
â”‚      "enabled": true,                                                        â”‚
â”‚      "email": "admin@example.com",                                           â”‚
â”‚      "domains": ["api.example.com", "www.example.com"],                      â”‚
â”‚      "challengeType": "http-01",                                             â”‚
â”‚      "renewBefore": 30,                                                      â”‚
â”‚      "staging": false                                                        â”‚
â”‚    }                                                                         â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### WebAssembly Filters Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      WEBASSEMBLY FILTERS (PLANNED)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  USE CASES:                                                                  â”‚
â”‚  â€¢ Custom authentication logic                                               â”‚
â”‚  â€¢ Request/response transformation                                           â”‚
â”‚  â€¢ Dynamic routing decisions                                                 â”‚
â”‚  â€¢ Rate limiting with custom algorithms                                      â”‚
â”‚  â€¢ Header manipulation                                                       â”‚
â”‚  â€¢ Body inspection and modification                                          â”‚
â”‚                                                                              â”‚
â”‚  FILTER CHAIN:                                                               â”‚
â”‚                                                                              â”‚
â”‚     Request â”€â”€â–¶ [Auth Filter] â”€â”€â–¶ [Transform Filter] â”€â”€â–¶ [Route Filter]     â”‚
â”‚                                                              â”‚               â”‚
â”‚                                                              â–¼               â”‚
â”‚     Response â—€â”€â”€ [Log Filter] â—€â”€â”€ [Transform Filter] â—€â”€â”€ Backend            â”‚
â”‚                                                                              â”‚
â”‚  EXAMPLE FILTER (Rust):                                                      â”‚
â”‚                                                                              â”‚
â”‚  #[no_mangle]                                                                â”‚
â”‚  pub extern "C" fn on_request_headers() -> i32 {                             â”‚
â”‚      // Get header                                                           â”‚
â”‚      let auth = get_header("authorization");                                 â”‚
â”‚                                                                              â”‚
â”‚      // Custom validation                                                    â”‚
â”‚      if !validate_custom_token(&auth) {                                      â”‚
â”‚          send_response(401, "Unauthorized");                                 â”‚
â”‚          return 0; // Stop processing                                        â”‚
â”‚      }                                                                       â”‚
â”‚                                                                              â”‚
â”‚      // Add header for backend                                               â”‚
â”‚      set_header("x-validated", "true");                                      â”‚
â”‚      return 1; // Continue                                                   â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  CONFIGURATION:                                                              â”‚
â”‚  {                                                                           â”‚
â”‚    "wasm": {                                                                 â”‚
â”‚      "filters": [                                                            â”‚
â”‚        {                                                                     â”‚
â”‚          "name": "custom-auth",                                              â”‚
â”‚          "path": "filters/auth.wasm",                                        â”‚
â”‚          "phase": "request_headers"                                          â”‚
â”‚        },                                                                    â”‚
â”‚        {                                                                     â”‚
â”‚          "name": "transform",                                                â”‚
â”‚          "path": "filters/transform.wasm",                                   â”‚
â”‚          "phase": "request_body"                                             â”‚
â”‚        }                                                                     â”‚
â”‚      ]                                                                       â”‚
â”‚    }                                                                         â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### GeoIP Routing Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GEOIP ROUTING (PLANNED)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  FEATURES:                                                                   â”‚
â”‚  â€¢ Route to nearest datacenter                                               â”‚
â”‚  â€¢ Comply with data residency requirements                                   â”‚
â”‚  â€¢ Block traffic from specific countries                                     â”‚
â”‚  â€¢ Custom rate limits by geography                                           â”‚
â”‚                                                                              â”‚
â”‚  ROUTING RULES:                                                              â”‚
â”‚  {                                                                           â”‚
â”‚    "geoip": {                                                                â”‚
â”‚      "database": "/var/lib/geoip/GeoLite2-City.mmdb",                        â”‚
â”‚      "rules": [                                                              â”‚
â”‚        {                                                                     â”‚
â”‚          "countries": ["US", "CA"],                                          â”‚
â”‚          "backend": { "datacenter": "us-east-1" }                            â”‚
â”‚        },                                                                    â”‚
â”‚        {                                                                     â”‚
â”‚          "countries": ["DE", "FR", "GB"],                                    â”‚
â”‚          "backend": { "datacenter": "eu-west-1" }                            â”‚
â”‚        },                                                                    â”‚
â”‚        {                                                                     â”‚
â”‚          "countries": ["CN", "RU"],                                          â”‚
â”‚          "action": "block"                                                   â”‚
â”‚        }                                                                     â”‚
â”‚      ],                                                                      â”‚
â”‚      "default": { "datacenter": "us-east-1" }                                â”‚
â”‚    }                                                                         â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  HEADERS ADDED:                                                              â”‚
â”‚  â€¢ X-Geo-Country: US                                                         â”‚
â”‚  â€¢ X-Geo-Region: California                                                  â”‚
â”‚  â€¢ X-Geo-City: San Francisco                                                 â”‚
â”‚  â€¢ X-Geo-Lat: 37.7749                                                        â”‚
â”‚  â€¢ X-Geo-Lon: -122.4194                                                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Contribution Guidelines

1. **Code Style**
   - Use consistent PowerShell naming conventions
   - Add XML documentation for public functions
   - Include unit tests for new features

2. **Testing**
   - Test with multiple backend types
   - Verify hot reload functionality
   - Load test with expected production traffic

3. **Documentation**
   - Update this document for new features
   - Include configuration examples
   - Document breaking changes

---

## License

MIT License - See LICENSE file for details.

## Support

- GitHub Issues: Report bugs and feature requests
- Documentation: This file and inline comments
- Community: Discussions and Q&A

---

*Last Updated: January 2026*
*Version: 1.0.0*