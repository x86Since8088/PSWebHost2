<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Modal Test - Diagnostic</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #2196f3;
        }
        .pass { border-left-color: #4caf50; }
        .fail { border-left-color: #f44336; }
        button {
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #2196f3;
            color: white;
            font-size: 16px;
        }
        button:hover {
            background: #1976d2;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Error Modal Function - Diagnostic Test</h1>

    <div id="results"></div>

    <div class="test-section">
        <h2>Test Actions</h2>
        <button onclick="testErrorModal()">Test Error Modal</button>
        <button onclick="runDiagnostics()">Re-run Diagnostics</button>
    </div>

    <!-- Load React from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Load Babel for JSX transpilation -->
    <script src="/public/lib/babel.min.js"></script>

    <!-- Load PSWeb SPA (requires Babel for JSX) -->
    <script type="text/babel" src="/public/psweb_spa.js"></script>

    <script>
        function runDiagnostics() {
            const results = document.getElementById('results');
            let html = '';

            // Test 1: Check if React is loaded
            const reactLoaded = typeof React !== 'undefined';
            html += `<div class="test-section ${reactLoaded ? 'pass' : 'fail'}">
                <h3>Test 1: React Library</h3>
                <p>Status: ${reactLoaded ? '✓ PASS' : '✗ FAIL'}</p>
                <p>React object: ${typeof React}</p>
                ${reactLoaded ? `<p>React version: ${React.version}</p>` : ''}
            </div>`;

            // Test 2: Check if ReactDOM is loaded
            const reactDOMLoaded = typeof ReactDOM !== 'undefined';
            html += `<div class="test-section ${reactDOMLoaded ? 'pass' : 'fail'}">
                <h3>Test 2: ReactDOM Library</h3>
                <p>Status: ${reactDOMLoaded ? '✓ PASS' : '✗ FAIL'}</p>
                <p>ReactDOM object: ${typeof ReactDOM}</p>
            </div>`;

            // Test 3: Check if window.showErrorModal exists
            const errorModalLoaded = typeof window.showErrorModal === 'function';
            html += `<div class="test-section ${errorModalLoaded ? 'pass' : 'fail'}">
                <h3>Test 3: window.showErrorModal Function</h3>
                <p>Status: ${errorModalLoaded ? '✓ PASS' : '✗ FAIL'}</p>
                <p>Function type: ${typeof window.showErrorModal}</p>
                ${errorModalLoaded ? `<pre>${window.showErrorModal.toString().substring(0, 200)}...</pre>` : ''}
            </div>`;

            // Test 4: Check if psweb_spa.js loaded
            const spaScripts = Array.from(document.scripts).filter(s => s.src.includes('psweb_spa.js'));
            html += `<div class="test-section ${spaScripts.length > 0 ? 'pass' : 'fail'}">
                <h3>Test 4: psweb_spa.js Script Tag</h3>
                <p>Status: ${spaScripts.length > 0 ? '✓ PASS' : '✗ FAIL'}</p>
                <p>Scripts found: ${spaScripts.length}</p>
                ${spaScripts.length > 0 ? `<p>Source: ${spaScripts[0].src}</p>` : ''}
            </div>`;

            // Test 5: Check console for errors
            html += `<div class="test-section">
                <h3>Test 5: Console Errors</h3>
                <p>Open browser DevTools Console (F12) to check for JavaScript errors</p>
                <p>Common issues:</p>
                <ul>
                    <li>Failed to load psweb_spa.js (404 or network error)</li>
                    <li>React failed to load from CDN</li>
                    <li>JavaScript syntax error in psweb_spa.js</li>
                    <li>CORS error loading React from CDN</li>
                </ul>
            </div>`;

            results.innerHTML = html;
        }

        function testErrorModal() {
            if (typeof window.showErrorModal !== 'function') {
                alert('ERROR: window.showErrorModal is not a function!\n\nPlease run diagnostics to identify the issue.');
                return;
            }

            const testData = {
                showModal: true,
                modalTitle: "Test Error Modal",
                modalType: "error-minimal",
                timestamp: new Date().toISOString(),
                error: "This is a test error message",
                requestId: "test-" + Date.now()
            };

            window.showErrorModal(testData);
        }

        // Run diagnostics on page load
        window.addEventListener('load', () => {
            setTimeout(runDiagnostics, 500);
        });
    </script>
</body>
</html>
